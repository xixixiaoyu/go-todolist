# ğŸ“š Go Todolist é¡¹ç›®å­¦ä¹ æ–‡æ¡£ - ç¬¬ä¸‰ç« ï¼šæ•°æ®å­˜å‚¨å±‚å¼€å‘

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæ‚¨å°†æŒæ¡ï¼š
- æ¥å£è®¾è®¡çš„æœ€ä½³å®è·µ
- å†…å­˜å­˜å‚¨çš„å®ç°æ–¹æ³•
- å¹¶å‘å®‰å…¨çš„ç¼–ç¨‹æŠ€å·§
- é”™è¯¯å¤„ç†çš„è®¾è®¡æ¨¡å¼

## ğŸ“‹ å­˜å‚¨å±‚æ¦‚è¿°

å­˜å‚¨å±‚æ˜¯åº”ç”¨ç¨‹åºçš„æ•°æ®æŒä¹…åŒ–å±‚ï¼Œè´Ÿè´£æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚è‰¯å¥½çš„å­˜å‚¨å±‚è®¾è®¡åº”è¯¥ï¼š

1. **æŠ½è±¡åŒ–**ï¼šé€šè¿‡æ¥å£å®šä¹‰ç»Ÿä¸€çš„æ•°æ®æ“ä½œå¥‘çº¦
2. **å¯æ‰©å±•**ï¼šæ”¯æŒå¤šç§å­˜å‚¨å®ç°ï¼ˆå†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ï¼‰
3. **çº¿ç¨‹å®‰å…¨**ï¼šæ”¯æŒå¹¶å‘è®¿é—®
4. **é”™è¯¯å¤„ç†**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

## ğŸ—ï¸ æ¥å£è®¾è®¡

### å­˜å‚¨æ¥å£å®šä¹‰

```go
// TodoStorage å®šä¹‰å­˜å‚¨æ¥å£
type TodoStorage interface {
    GetAll() ([]*models.Todo, error)
    GetByID(id int) (*models.Todo, error)
    Create(req *models.CreateTodoRequest) (*models.Todo, error)
    Update(id int, req *models.UpdateTodoRequest) (*models.Todo, error)
    Delete(id int) error
}
```

### æ¥å£è®¾è®¡åŸåˆ™

#### 1. æ–¹æ³•å‘½åè§„èŒƒ
- `GetAll()` - è·å–æ‰€æœ‰è®°å½•
- `GetByID()` - æ ¹æ® ID è·å–å•æ¡è®°å½•
- `Create()` - åˆ›å»ºæ–°è®°å½•
- `Update()` - æ›´æ–°ç°æœ‰è®°å½•
- `Delete()` - åˆ é™¤è®°å½•

#### 2. å‚æ•°è®¾è®¡
- **è¾“å…¥å‚æ•°**ï¼šä½¿ç”¨è¯·æ±‚æ¨¡å‹è€ŒéåŸå§‹ç±»å‹
- **è¿”å›å€¼**ï¼šè¿”å›å®Œæ•´çš„æ¨¡å‹å¯¹è±¡
- **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰æ–¹æ³•éƒ½è¿”å› error

#### 3. æ¥å£ä¼˜åŠ¿
```go
// å¯ä»¥è½»æ¾åˆ‡æ¢ä¸åŒçš„å­˜å‚¨å®ç°
var storage TodoStorage

// å†…å­˜å­˜å‚¨
storage = NewMemoryStorage()

// æ–‡ä»¶å­˜å‚¨ï¼ˆæœªæ¥æ‰©å±•ï¼‰
// storage = NewFileStorage("todos.json")

// æ•°æ®åº“å­˜å‚¨ï¼ˆæœªæ¥æ‰©å±•ï¼‰
// storage = NewDatabaseStorage(db)
```

## ğŸ’¾ å†…å­˜å­˜å‚¨å®ç°

### æ•°æ®ç»“æ„è®¾è®¡

```go
// MemoryStorage å†…å­˜å­˜å‚¨å®ç°
type MemoryStorage struct {
    todos  map[int]*models.Todo  // å­˜å‚¨å¾…åŠäº‹é¡¹çš„æ˜ å°„è¡¨
    nextID int                   // ä¸‹ä¸€ä¸ªå¯ç”¨çš„ ID
    mutex  sync.RWMutex         // è¯»å†™é”ï¼Œç¡®ä¿å¹¶å‘å®‰å…¨
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | ä½œç”¨ |
|------|------|------|
| `todos` | `map[int]*models.Todo` | ä½¿ç”¨ map å­˜å‚¨æ•°æ®ï¼Œkey ä¸º ID |
| `nextID` | `int` | è‡ªå¢ ID ç”Ÿæˆå™¨ |
| `mutex` | `sync.RWMutex` | è¯»å†™é”ï¼Œä¿è¯å¹¶å‘å®‰å…¨ |

### ä¸ºä»€ä¹ˆä½¿ç”¨ mapï¼Ÿ
- **O(1) æŸ¥æ‰¾**ï¼šæ ¹æ® ID å¿«é€Ÿå®šä½æ•°æ®
- **å†…å­˜æ•ˆç‡**ï¼šåªå­˜å‚¨æŒ‡é’ˆï¼ŒèŠ‚çœå†…å­˜
- **æ“ä½œç®€å•**ï¼šå¢åˆ æ”¹æŸ¥æ“ä½œç›´è§‚

### ä¸ºä»€ä¹ˆä½¿ç”¨è¯»å†™é”ï¼Ÿ
- **è¯»æ“ä½œå¹¶å‘**ï¼šå¤šä¸ª goroutine å¯ä»¥åŒæ—¶è¯»å–
- **å†™æ“ä½œäº’æ–¥**ï¼šå†™æ“ä½œæ—¶é˜»å¡æ‰€æœ‰è¯»å†™æ“ä½œ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹æ€§èƒ½æ›´å¥½

## ğŸ”§ CRUD æ“ä½œå®ç°

### 1. åˆ›å»ºæ“ä½œ (Create)

```go
// Create åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹
func (s *MemoryStorage) Create(req *models.CreateTodoRequest) (*models.Todo, error) {
    s.mutex.Lock()           // è·å–å†™é”
    defer s.mutex.Unlock()   // ç¡®ä¿é”è¢«é‡Šæ”¾
    
    now := time.Now()
    todo := &models.Todo{
        ID:          s.nextID,
        Title:       req.Title,
        Description: req.Description,
        Completed:   false,      // æ–°åˆ›å»ºçš„å¾…åŠäº‹é¡¹é»˜è®¤æœªå®Œæˆ
        CreatedAt:   now,
        UpdatedAt:   now,
    }
    
    s.todos[s.nextID] = todo  // å­˜å‚¨åˆ° map ä¸­
    s.nextID++                // ID è‡ªå¢
    
    return todo, nil
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨å†™é”ä¿è¯çº¿ç¨‹å®‰å…¨
- è‡ªåŠ¨è®¾ç½®åˆ›å»ºå’Œæ›´æ–°æ—¶é—´
- ID è‡ªåŠ¨é€’å¢
- è¿”å›å®Œæ•´çš„ Todo å¯¹è±¡

### 2. è¯»å–æ“ä½œ (Read)

#### è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹

```go
// GetAll è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹
func (s *MemoryStorage) GetAll() ([]*models.Todo, error) {
    s.mutex.RLock()          // è·å–è¯»é”
    defer s.mutex.RUnlock()  // ç¡®ä¿é”è¢«é‡Šæ”¾
    
    todos := make([]*models.Todo, 0, len(s.todos))  // é¢„åˆ†é…å®¹é‡
    for _, todo := range s.todos {
        todos = append(todos, todo)
    }
    return todos, nil
}
```

#### æ ¹æ® ID è·å–å¾…åŠäº‹é¡¹

```go
// GetByID æ ¹æ®IDè·å–å¾…åŠäº‹é¡¹
func (s *MemoryStorage) GetByID(id int) (*models.Todo, error) {
    s.mutex.RLock()
    defer s.mutex.RUnlock()
    
    todo, exists := s.todos[id]  // æ£€æŸ¥æ˜¯å¦å­˜åœ¨
    if !exists {
        return nil, ErrTodoNotFound
    }
    return todo, nil
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨è¯»é”å…è®¸å¹¶å‘è¯»å–
- é¢„åˆ†é…åˆ‡ç‰‡å®¹é‡æé«˜æ€§èƒ½
- æ˜ç¡®çš„é”™è¯¯å¤„ç†

### 3. æ›´æ–°æ“ä½œ (Update)

```go
// Update æ›´æ–°å¾…åŠäº‹é¡¹
func (s *MemoryStorage) Update(id int, req *models.UpdateTodoRequest) (*models.Todo, error) {
    s.mutex.Lock()
    defer s.mutex.Unlock()
    
    todo, exists := s.todos[id]
    if !exists {
        return nil, ErrTodoNotFound
    }
    
    // éƒ¨åˆ†æ›´æ–°é€»è¾‘
    if req.Title != nil {
        todo.Title = *req.Title
    }
    if req.Description != nil {
        todo.Description = *req.Description
    }
    if req.Completed != nil {
        todo.Completed = *req.Completed
    }
    todo.UpdatedAt = time.Now()  // æ›´æ–°æ—¶é—´æˆ³
    
    return todo, nil
}
```

**å…³é”®ç‚¹ï¼š**
- æ”¯æŒéƒ¨åˆ†æ›´æ–°ï¼ˆåªæ›´æ–°æä¾›çš„å­—æ®µï¼‰
- è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
- è¿”å›æ›´æ–°åçš„å®Œæ•´å¯¹è±¡

### 4. åˆ é™¤æ“ä½œ (Delete)

```go
// Delete åˆ é™¤å¾…åŠäº‹é¡¹
func (s *MemoryStorage) Delete(id int) error {
    s.mutex.Lock()
    defer s.mutex.Unlock()
    
    if _, exists := s.todos[id]; !exists {
        return ErrTodoNotFound
    }
    
    delete(s.todos, id)  // ä» map ä¸­åˆ é™¤
    return nil
}
```

**å…³é”®ç‚¹ï¼š**
- å…ˆæ£€æŸ¥å­˜åœ¨æ€§å†åˆ é™¤
- ä½¿ç”¨ `delete()` å‡½æ•°åˆ é™¤ map å…ƒç´ 
- ç®€æ´çš„é”™è¯¯å¤„ç†

## âŒ é”™è¯¯å¤„ç†è®¾è®¡

### è‡ªå®šä¹‰é”™è¯¯

```go
var (
    ErrTodoNotFound = errors.New("å¾…åŠäº‹é¡¹æœªæ‰¾åˆ°")
)
```

### é”™è¯¯å¤„ç†ç­–ç•¥

1. **é¢„å®šä¹‰é”™è¯¯**ï¼šä½¿ç”¨ `var` å£°æ˜å¸¸è§é”™è¯¯
2. **é”™è¯¯æ£€æŸ¥**ï¼šåœ¨æ“ä½œå‰æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
3. **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ–¹æ³•éƒ½è¿”å›ç›¸åŒç±»å‹çš„é”™è¯¯
4. **ç”¨æˆ·å‹å¥½**ï¼šé”™è¯¯æ¶ˆæ¯ä½¿ç”¨ä¸­æ–‡ï¼Œä¾¿äºç†è§£

## ğŸ­ æ„é€ å‡½æ•°è®¾è®¡

```go
// NewMemoryStorage åˆ›å»ºæ–°çš„å†…å­˜å­˜å‚¨å®ä¾‹
func NewMemoryStorage() *MemoryStorage {
    return &MemoryStorage{
        todos:  make(map[int]*models.Todo),
        nextID: 1,  // ID ä» 1 å¼€å§‹
    }
}
```

**è®¾è®¡è¦ç‚¹ï¼š**
- åˆå§‹åŒ–æ‰€æœ‰å¿…è¦å­—æ®µ
- ID ä» 1 å¼€å§‹ï¼ˆæ›´ç¬¦åˆç”¨æˆ·ä¹ æƒ¯ï¼‰
- è¿”å›æŒ‡é’ˆç±»å‹ï¼ˆé¿å…å¤§å¯¹è±¡å¤åˆ¶ï¼‰

## ğŸ”’ å¹¶å‘å®‰å…¨è¯¦è§£

### è¯»å†™é”çš„ä½¿ç”¨åœºæ™¯

```go
// è¯»æ“ä½œï¼šä½¿ç”¨è¯»é”
func (s *MemoryStorage) GetAll() ([]*models.Todo, error) {
    s.mutex.RLock()    // å¤šä¸ª goroutine å¯ä»¥åŒæ—¶è·å–è¯»é”
    defer s.mutex.RUnlock()
    // ... è¯»å–æ“ä½œ
}

// å†™æ“ä½œï¼šä½¿ç”¨å†™é”
func (s *MemoryStorage) Create(req *models.CreateTodoRequest) (*models.Todo, error) {
    s.mutex.Lock()     // å†™é”æ˜¯æ’ä»–çš„
    defer s.mutex.Unlock()
    // ... å†™å…¥æ“ä½œ
}
```

### å¹¶å‘å®‰å…¨çš„é‡è¦æ€§

1. **æ•°æ®ç«äº‰**ï¼šé˜²æ­¢å¤šä¸ª goroutine åŒæ—¶ä¿®æ”¹æ•°æ®
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿è¯»å–åˆ°çš„æ•°æ®æ˜¯å®Œæ•´çš„
3. **å†…å­˜å®‰å…¨**ï¼šé¿å…ç¨‹åºå´©æºƒå’Œæ•°æ®æŸå

## ğŸ§ª å®Œæ•´å®ç°ä»£ç 

### storage/memory.go

```go
package storage

import (
    "errors"
    "sync"
    "time"
    
    "go-todolist/models"
)

var (
    ErrTodoNotFound = errors.New("å¾…åŠäº‹é¡¹æœªæ‰¾åˆ°")
)

// MemoryStorage å†…å­˜å­˜å‚¨å®ç°
type MemoryStorage struct {
    todos  map[int]*models.Todo
    nextID int
    mutex  sync.RWMutex
}

// NewMemoryStorage åˆ›å»ºæ–°çš„å†…å­˜å­˜å‚¨å®ä¾‹
func NewMemoryStorage() *MemoryStorage {
    return &MemoryStorage{
        todos:  make(map[int]*models.Todo),
        nextID: 1,
    }
}

// GetAll è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹
func (s *MemoryStorage) GetAll() ([]*models.Todo, error) {
    s.mutex.RLock()
    defer s.mutex.RUnlock()
    
    todos := make([]*models.Todo, 0, len(s.todos))
    for _, todo := range s.todos {
        todos = append(todos, todo)
    }
    return todos, nil
}

// GetByID æ ¹æ®IDè·å–å¾…åŠäº‹é¡¹
func (s *MemoryStorage) GetByID(id int) (*models.Todo, error) {
    s.mutex.RLock()
    defer s.mutex.RUnlock()
    
    todo, exists := s.todos[id]
    if !exists {
        return nil, ErrTodoNotFound
    }
    return todo, nil
}

// Create åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹
func (s *MemoryStorage) Create(req *models.CreateTodoRequest) (*models.Todo, error) {
    s.mutex.Lock()
    defer s.mutex.Unlock()
    
    now := time.Now()
    todo := &models.Todo{
        ID:          s.nextID,
        Title:       req.Title,
        Description: req.Description,
        Completed:   false,
        CreatedAt:   now,
        UpdatedAt:   now,
    }
    
    s.todos[s.nextID] = todo
    s.nextID++
    
    return todo, nil
}

// Update æ›´æ–°å¾…åŠäº‹é¡¹
func (s *MemoryStorage) Update(id int, req *models.UpdateTodoRequest) (*models.Todo, error) {
    s.mutex.Lock()
    defer s.mutex.Unlock()
    
    todo, exists := s.todos[id]
    if !exists {
        return nil, ErrTodoNotFound
    }
    
    // æ›´æ–°å­—æ®µ
    if req.Title != nil {
        todo.Title = *req.Title
    }
    if req.Description != nil {
        todo.Description = *req.Description
    }
    if req.Completed != nil {
        todo.Completed = *req.Completed
    }
    todo.UpdatedAt = time.Now()
    
    return todo, nil
}

// Delete åˆ é™¤å¾…åŠäº‹é¡¹
func (s *MemoryStorage) Delete(id int) error {
    s.mutex.Lock()
    defer s.mutex.Unlock()
    
    if _, exists := s.todos[id]; !exists {
        return ErrTodoNotFound
    }
    
    delete(s.todos, id)
    return nil
}

// TodoStorage å®šä¹‰å­˜å‚¨æ¥å£
type TodoStorage interface {
    GetAll() ([]*models.Todo, error)
    GetByID(id int) (*models.Todo, error)
    Create(req *models.CreateTodoRequest) (*models.Todo, error)
    Update(id int, req *models.UpdateTodoRequest) (*models.Todo, error)
    Delete(id int) error
}
```

## ğŸ¯ æœ¬ç« å°ç»“

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæˆ‘ä»¬å®Œæˆäº†ï¼š

1. âœ… **æ¥å£è®¾è®¡**ï¼šå®šä¹‰äº†æ¸…æ™°çš„å­˜å‚¨å¥‘çº¦
2. âœ… **å†…å­˜å­˜å‚¨å®ç°**ï¼šé«˜æ•ˆçš„æ•°æ®æ“ä½œ
3. âœ… **å¹¶å‘å®‰å…¨**ï¼šä½¿ç”¨è¯»å†™é”ä¿è¯çº¿ç¨‹å®‰å…¨
4. âœ… **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç­–ç•¥

### å…³é”®æ”¶è·
- ç†è§£äº†æ¥å£åœ¨ Go ä¸­çš„é‡è¦ä½œç”¨
- æŒæ¡äº† map å’Œè¯»å†™é”çš„ä½¿ç”¨
- å­¦ä¼šäº†è®¾è®¡å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„
- å®ç°äº†å®Œæ•´çš„ CRUD æ“ä½œ

### ä¸‹ä¸€æ­¥
åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†å®ç° HTTP å¤„ç†å™¨ï¼Œå­¦ä¹ å¦‚ä½•å°†å­˜å‚¨å±‚ä¸ Web API è¿æ¥èµ·æ¥ã€‚

---

**å­˜å‚¨å±‚æ˜¯æ•°æ®çš„å®ˆæŠ¤è€…ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨å’Œä¸€è‡´æ€§ï¼** ğŸš€
