# ğŸ“š Go Todolist é¡¹ç›®å­¦ä¹ æ–‡æ¡£ - ç¬¬äº”ç« ï¼šä¸»ç¨‹åºå’Œè·¯ç”±é…ç½®

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæ‚¨å°†æŒæ¡ï¼š
- Go åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹è®¾è®¡
- HTTP æœåŠ¡å™¨çš„é…ç½®å’Œå¯åŠ¨
- è·¯ç”±ç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°
- é™æ€æ–‡ä»¶æœåŠ¡çš„é…ç½®
- ç¯å¢ƒå˜é‡çš„ä½¿ç”¨

## ğŸ“‹ ä¸»ç¨‹åºæ¦‚è¿°

ä¸»ç¨‹åºï¼ˆmain.goï¼‰æ˜¯ Go åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè´Ÿè´£ï¼š

1. **ä¾èµ–ç»„è£…**ï¼šåˆ›å»ºå’Œè¿æ¥å„ä¸ªç»„ä»¶
2. **è·¯ç”±é…ç½®**ï¼šè®¾ç½® HTTP è·¯ç”±è§„åˆ™
3. **æœåŠ¡å™¨å¯åŠ¨**ï¼šå¯åŠ¨ HTTP æœåŠ¡å™¨
4. **é™æ€æ–‡ä»¶æœåŠ¡**ï¼šæä¾›å‰ç«¯èµ„æº
5. **ä¼˜é›…å…³é—­**ï¼šå¤„ç†ç¨‹åºé€€å‡º

## ğŸ—ï¸ ç¨‹åºç»“æ„è®¾è®¡

### ä¸»è¦ç»„ä»¶

```go
package main

import (
    "fmt"
    "log"
    "net/http"
    "os"

    "go-todolist/handlers"
    "go-todolist/storage"
)
```

### å¯¼å…¥è¯´æ˜

| åŒ… | ç”¨é€” |
|---|---|
| `fmt` | æ ¼å¼åŒ–è¾“å‡ºï¼Œæ˜¾ç¤ºå¯åŠ¨ä¿¡æ¯ |
| `log` | æ—¥å¿—è®°å½•ï¼Œå¤„ç†é”™è¯¯ |
| `net/http` | HTTP æœåŠ¡å™¨å’Œè·¯ç”± |
| `os` | ç¯å¢ƒå˜é‡è¯»å– |
| `go-todolist/handlers` | è‡ªå®šä¹‰ HTTP å¤„ç†å™¨ |
| `go-todolist/storage` | è‡ªå®šä¹‰å­˜å‚¨å±‚ |

## ğŸ”§ ä¾èµ–æ³¨å…¥æ¨¡å¼

### ç»„ä»¶åˆ›å»ºå’Œç»„è£…

```go
func main() {
    // åˆ›å»ºå­˜å‚¨å®ä¾‹
    todoStorage := storage.NewMemoryStorage()

    // åˆ›å»ºå¤„ç†å™¨
    todoHandler := handlers.NewTodoHandler(todoStorage)
    
    // ... å…¶ä»–é…ç½®
}
```

### ä¾èµ–æ³¨å…¥çš„ä¼˜åŠ¿

1. **æ¾è€¦åˆ**ï¼šç»„ä»¶ä¹‹é—´é€šè¿‡æ¥å£è¿æ¥
2. **å¯æµ‹è¯•**ï¼šå®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•
3. **å¯æ‰©å±•**ï¼šå®¹æ˜“æ›¿æ¢ä¸åŒçš„å®ç°
4. **æ¸…æ™°çš„ä¾èµ–å…³ç³»**ï¼šæ˜ç¡®ç»„ä»¶ä¹‹é—´çš„ä¾èµ–

### ä¾èµ–å…³ç³»å›¾

```
main.go
  â†“
handlers.TodoHandler
  â†“
storage.TodoStorage (interface)
  â†“
storage.MemoryStorage (implementation)
```

## ğŸŒ è·¯ç”±é…ç½®

### HTTP è·¯ç”±è®¾ç½®

```go
// è®¾ç½®è·¯ç”±
mux := http.NewServeMux()

// API è·¯ç”±
mux.Handle("/api/todos", todoHandler)
mux.Handle("/api/todos/", todoHandler)

// é™æ€æ–‡ä»¶æœåŠ¡
fileServer := http.FileServer(http.Dir("./static/"))
mux.Handle("/", fileServer)
```

### è·¯ç”±è®¾è®¡è¯´æ˜

#### 1. API è·¯ç”±
```go
mux.Handle("/api/todos", todoHandler)     // ç²¾ç¡®åŒ¹é… /api/todos
mux.Handle("/api/todos/", todoHandler)    // åŒ¹é… /api/todos/ åŠå…¶å­è·¯å¾„
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªè·¯ç”±ï¼Ÿ**
- `/api/todos` - å¤„ç†é›†åˆæ“ä½œï¼ˆGET æ‰€æœ‰ã€POST åˆ›å»ºï¼‰
- `/api/todos/` - å¤„ç†å•ä¸ªèµ„æºæ“ä½œï¼ˆGET/PUT/DELETE å•ä¸ªï¼‰

#### 2. é™æ€æ–‡ä»¶æœåŠ¡
```go
fileServer := http.FileServer(http.Dir("./static/"))
mux.Handle("/", fileServer)
```

**é™æ€æ–‡ä»¶æœåŠ¡ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨å¤„ç† `index.html`
- æ”¯æŒæ‰€æœ‰é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ç­‰ï¼‰
- è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„ Content-Type
- æ”¯æŒç¼“å­˜å¤´

### è·¯ç”±ä¼˜å…ˆçº§

Go çš„ `http.ServeMux` æŒ‰ç…§æœ€é•¿åŒ¹é…åŸåˆ™ï¼š

1. `/api/todos/123` â†’ åŒ¹é… `/api/todos/`
2. `/api/todos` â†’ åŒ¹é… `/api/todos`
3. `/` â†’ åŒ¹é… `/`ï¼ˆé»˜è®¤è·¯ç”±ï¼‰

## âš™ï¸ æœåŠ¡å™¨é…ç½®

### ç«¯å£é…ç½®

```go
// è·å–ç«¯å£å·
port := os.Getenv("PORT")
if port == "" {
    port = "8080"  // é»˜è®¤ç«¯å£
}

addr := ":" + port
```

### ç¯å¢ƒå˜é‡çš„ä½¿ç”¨

**ä¸ºä»€ä¹ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Ÿ**
1. **éƒ¨ç½²çµæ´»æ€§**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
2. **å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯ä¸å†™å…¥ä»£ç 
3. **äº‘å¹³å°å…¼å®¹**ï¼šå¤§å¤šæ•°äº‘å¹³å°é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# å¼€å‘ç¯å¢ƒ
go run main.go

# ç”Ÿäº§ç¯å¢ƒ
PORT=3000 go run main.go

# Docker ç¯å¢ƒ
docker run -e PORT=8080 myapp
```

## ğŸš€ æœåŠ¡å™¨å¯åŠ¨

### å¯åŠ¨ä¿¡æ¯æ˜¾ç¤º

```go
// å¯åŠ¨æœåŠ¡å™¨
fmt.Printf("ğŸš€ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼\n")
fmt.Printf("ğŸ“± å‰ç«¯åœ°å€: http://localhost%s\n", addr)
fmt.Printf("ğŸ”— API åœ°å€: http://localhost%s/api/todos\n", addr)
fmt.Printf("â¹ï¸  æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨\n\n")

log.Fatal(http.ListenAndServe(addr, mux))
```

### å¯åŠ¨ä¿¡æ¯è®¾è®¡

1. **ç”¨æˆ·å‹å¥½**ï¼šä½¿ç”¨ emoji å’Œæ¸…æ™°çš„æè¿°
2. **å®ç”¨ä¿¡æ¯**ï¼šæä¾›å¯ç‚¹å‡»çš„ URL
3. **æ“ä½œæŒ‡å¯¼**ï¼šå‘Šè¯‰ç”¨æˆ·å¦‚ä½•åœæ­¢æœåŠ¡å™¨

### é”™è¯¯å¤„ç†

```go
log.Fatal(http.ListenAndServe(addr, mux))
```

`log.Fatal` çš„ä½œç”¨ï¼š
- å¦‚æœæœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Œè®°å½•é”™è¯¯å¹¶é€€å‡º
- å¦‚æœæœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼Œä¼šä¸€ç›´é˜»å¡
- å½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œç¨‹åºé€€å‡º

## ğŸ“ å®Œæ•´çš„ main.go å®ç°

```go
package main

import (
    "fmt"
    "log"
    "net/http"
    "os"

    "go-todolist/handlers"
    "go-todolist/storage"
)

func main() {
    // åˆ›å»ºå­˜å‚¨å®ä¾‹
    todoStorage := storage.NewMemoryStorage()

    // åˆ›å»ºå¤„ç†å™¨
    todoHandler := handlers.NewTodoHandler(todoStorage)

    // è®¾ç½®è·¯ç”±
    mux := http.NewServeMux()

    // API è·¯ç”±
    mux.Handle("/api/todos", todoHandler)
    mux.Handle("/api/todos/", todoHandler)

    // é™æ€æ–‡ä»¶æœåŠ¡
    fileServer := http.FileServer(http.Dir("./static/"))
    mux.Handle("/", fileServer)

    // è·å–ç«¯å£å·
    port := os.Getenv("PORT")
    if port == "" {
        port = "8080"
    }

    // å¯åŠ¨æœåŠ¡å™¨
    addr := ":" + port
    fmt.Printf("ğŸš€ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼\n")
    fmt.Printf("ğŸ“± å‰ç«¯åœ°å€: http://localhost%s\n", addr)
    fmt.Printf("ğŸ”— API åœ°å€: http://localhost%s/api/todos\n", addr)
    fmt.Printf("â¹ï¸  æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨\n\n")

    log.Fatal(http.ListenAndServe(addr, mux))
}
```

## ğŸ”§ é«˜çº§é…ç½®é€‰é¡¹

### 1. æœåŠ¡å™¨è¶…æ—¶é…ç½®

```go
server := &http.Server{
    Addr:         addr,
    Handler:      mux,
    ReadTimeout:  15 * time.Second,
    WriteTimeout: 15 * time.Second,
    IdleTimeout:  60 * time.Second,
}

log.Fatal(server.ListenAndServe())
```

### 2. ä¼˜é›…å…³é—­

```go
// åˆ›å»ºä¸€ä¸ªé€šé“æ¥æ¥æ”¶ä¸­æ–­ä¿¡å·
c := make(chan os.Signal, 1)
signal.Notify(c, os.Interrupt, syscall.SIGTERM)

// åœ¨ goroutine ä¸­å¯åŠ¨æœåŠ¡å™¨
go func() {
    log.Fatal(server.ListenAndServe())
}()

// ç­‰å¾…ä¸­æ–­ä¿¡å·
<-c
fmt.Println("\næ­£åœ¨ä¼˜é›…å…³é—­æœåŠ¡å™¨...")

// åˆ›å»ºè¶…æ—¶ä¸Šä¸‹æ–‡
ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
defer cancel()

// ä¼˜é›…å…³é—­æœåŠ¡å™¨
server.Shutdown(ctx)
fmt.Println("æœåŠ¡å™¨å·²å…³é—­")
```

### 3. ä¸­é—´ä»¶æ”¯æŒ

```go
// æ—¥å¿—ä¸­é—´ä»¶
func loggingMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        start := time.Now()
        next.ServeHTTP(w, r)
        log.Printf("%s %s %v", r.Method, r.URL.Path, time.Since(start))
    })
}

// ä½¿ç”¨ä¸­é—´ä»¶
mux.Handle("/api/todos", loggingMiddleware(todoHandler))
```

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### 1. å¯åŠ¨æµ‹è¯•

```bash
# å¯åŠ¨æœåŠ¡å™¨
go run main.go

# æµ‹è¯• API
curl http://localhost:8080/api/todos

# æµ‹è¯•å‰ç«¯
open http://localhost:8080
```

### 2. ç«¯å£å†²çªå¤„ç†

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :8080

# ä½¿ç”¨ä¸åŒç«¯å£
PORT=3000 go run main.go
```

### 3. è°ƒè¯•æŠ€å·§

```go
// æ·»åŠ è°ƒè¯•ä¿¡æ¯
fmt.Printf("å­˜å‚¨å®ä¾‹åˆ›å»ºæˆåŠŸ: %T\n", todoStorage)
fmt.Printf("å¤„ç†å™¨åˆ›å»ºæˆåŠŸ: %T\n", todoHandler)
fmt.Printf("è·¯ç”±é…ç½®å®Œæˆ\n")
```

## ğŸ¯ æœ¬ç« å°ç»“

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæˆ‘ä»¬å®Œæˆäº†ï¼š

1. âœ… **ä¸»ç¨‹åºè®¾è®¡**ï¼šå®ç°äº†åº”ç”¨ç¨‹åºå…¥å£ç‚¹
2. âœ… **ä¾èµ–æ³¨å…¥**ï¼šæ­£ç¡®ç»„è£…äº†å„ä¸ªç»„ä»¶
3. âœ… **è·¯ç”±é…ç½®**ï¼šè®¾ç½®äº† API å’Œé™æ€æ–‡ä»¶è·¯ç”±
4. âœ… **æœåŠ¡å™¨å¯åŠ¨**ï¼šé…ç½®å¹¶å¯åŠ¨äº† HTTP æœåŠ¡å™¨
5. âœ… **ç¯å¢ƒé…ç½®**ï¼šæ”¯æŒç¯å¢ƒå˜é‡é…ç½®

### å…³é”®æ”¶è·
- ç†è§£äº† Go åº”ç”¨ç¨‹åºçš„å¯åŠ¨æµç¨‹
- æŒæ¡äº†ä¾èµ–æ³¨å…¥çš„è®¾è®¡æ¨¡å¼
- å­¦ä¼šäº† HTTP è·¯ç”±çš„é…ç½®æ–¹æ³•
- å®ç°äº†é™æ€æ–‡ä»¶æœåŠ¡

### ä¸‹ä¸€æ­¥
åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¼€å‘å‰ç«¯ç•Œé¢ï¼Œåˆ›å»ºç”¨æˆ·å‹å¥½çš„å¾…åŠäº‹é¡¹ç®¡ç†ç•Œé¢ã€‚

---

**ä¸»ç¨‹åºæ˜¯åº”ç”¨çš„æŒ‡æŒ¥ä¸­å¿ƒï¼Œå®ƒåè°ƒæ‰€æœ‰ç»„ä»¶å…±åŒå·¥ä½œï¼** ğŸš€
